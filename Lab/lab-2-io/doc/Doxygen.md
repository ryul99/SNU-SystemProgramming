[[_TOC_]]

# Doxygen

Doxygen is a powerful documentation generator. It is similar to Javadoc but supports a wide range of languages and output formats.

We use Doxygen throughout this course to document our source code.

## 1. Usage

### 1.1 Documenting the code

The [official Doxygen manual](https://www.doxygen.nl/manual/index.html) can be a bit overwhelming. We only use the few Doxygen commands that are described below.

Use the triple slash (`///`) to indicate Doxygen-related comments.

| Command | Description |
|---      |---          |
| [@brief](https://www.doxygen.nl/manual/commands.html#cmdbrief)  | brief description of an entity (file, function, struct, ...). Can span several lines and ends with a blank line. |
| [@param](https://www.doxygen.nl/manual/commands.html#cmdparam)  | describe a parameter |
| [@retval](https://www.doxygen.nl/manual/commands.html#cmdretval) | describe a return value |
| [@a](https://www.doxygen.nl/manual/commands.html#cmda)      | use in @brief to link to a parameter |
| [@author](https://www.doxygen.nl/manual/commands.html#cmdauthor) | indicate the author of the file |
| [@file](https://www.doxygen.nl/manual/commands.html#cmdfile)   | replaced by the actual name of the file |
| [<](https://www.doxygen.nl/manual/docblocks.html#memberdoc)       | member comment inside structs |

Example
```C
/// @file
/// @author Bernhard Egger <bernhard@csap.snu.ac.kr>

/// @brief struct holding statistics about a directory
struct summary {
  unsigned int dirs;          ///< number of directories
  unsigned int files;         ///< number of files
};

/// @brief recursively process directory @a dn and print its tree
///
/// @param dn path string denoting directory
/// @param pstr prefix string to print tree view
/// @retval 0 on success
/// @retval -1 on error
int processDir(const char *dn, const char *pstr)
{
   ...
}
```

The documentation generated for the example can be viewed at https://csap.snu.ac.kr/sysprog/doxygen/index.html. Since we didn't define a main page, the first page is blank. Go to Files -> File List and select a file to look at.

### 1.2 Compiling the documentation

The documentation is generated by running Doxygen. Doxygen requires a configuration file `Doxyfile` to be present in the current directory. A template `Doxyfile` can be generated by running `doxygen -g`, but we will always provide a pre-configured configuration file along with the handouts.

Run Doxygen as follows
```bash
$ doxygen
Searching for include files...
Searching for example files...
Searching for images...
...
Running dot...
lookup cache used 152/65536 hits=740 misses=228
finished...
```
### 1.3 Viewing the generated documentation

The `Doxyfile` used in this course generates HTML documentation in the path `doc/html`. You can look at the documentation in Firefox:
```bash
$ firefox-bin doc/html/index.html
```
Since we didn't define a main page, the first page is blank. Go to Files -> File List and select a file to look at.


## 2 Installation

The VM already contains all necessary tools to run Doxygen. If you use your own machine, you can install Doxygen and its dependencies via your distribution's package manager or install Doxygen and the required tools (Graphviz, Ghostscript) from source.

Hint: copy-paste from this window to the terminal running inside the VM works. Select the command(s) with your mouse, hit <Ctrl-C>, place the mouse in the VM's terminal, right-click, and select Paste.

### 2.1 Ghostscript

Download the most recent release and install as follows:
```bash
cd ~/temp
git clone --depth 1 --branch ghostscript-9.53.3 git://git.ghostscript.com/ghostpdl.git
cd ghostpdl
./autogen.sh
./configure
make -j4
sudo make install
```
`sudo` gives you temporary administrator rights after entering your password (`devel` in the virtual machine).

### 2.2 Graphviz

```bash
cd ~/temp
git clone --depth 1 --branch 2.47.1 https://gitlab.com/graphviz/graphviz.git
cd graphviz
./autogen.sh
./configure
make -j4
sudo make install
```

### 2.3 Doxygen

```bash
cd ~/temp
git clone --depth 1 --branch Release_1_9_1 https://github.com/doxygen/doxygen.git
cd doxygen
mkdir build
cd build
cmake -G "Unix Makefiles" ..
make -j4
sudo make install
```

### 2.4 Cleaning up

It is safe to remove the source directories of the three tools after installation to free up some space. This frees about 1GB of data on your disk.

```bash
cd ~/temp
rm -rf ghostpdl graphviz doxygen
```

### 2.5 Snapshot

Do not forget to shutdown the VM by either entering `sudo shutdown -h now` at the terminal or through the GUI (Applications -> Log Out -> Shut Down) and then create a new snapshot.
